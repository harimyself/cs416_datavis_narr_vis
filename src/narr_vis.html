<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title></title>
<script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .job-title {
            text-shadow: 1px 1px gray;
            font-size: 20px;
            font-family: sans-serif;
            text-decoration: underline;
        }
    </style>
</head>
<body>

<table width="100%" height="100%">

    <tbody>
        <tr>
            <td>
                <div id="job_title" style="height: 100%;"></div>
            </td>
            <td>
                <div id="data_plot" height = '100%'></div>
            </td>
        </tr>
    </tbody>
</table>


</svg>

<script type="text/javascript">

    const data_loader = d3.csv('ds_salaries.csv');
    var total_width, total_height;

    data_loader.then(render_svg);

    function render_svg(data) {

        svg = d3.select('#job_title')
            .append('svg')
            .attr('height', '100%');

        job_titles = new Set()
        for (let index = 0; index < data.length; ++index) {
            // if(data[index].job_title.toLowerCase())
            job_titles.add(data[index].job_title);
        }
        // var total_width = parseInt(svg.style("width"), 10);
        // var total_height = parseInt(svg.style("height"), 10);

        // console.log(job_titles);

        svg.selectAll()
            .data(job_titles)
            .enter()
            .append('text')
            .attr("class", 'job-title')
            .attr("x", 10)
            .attr("y", function(d,i) { return (i+1) * 50; })
                // .attr("fill", "black")
                // .attr("dy", ".35em")
            .text(function(d,i) {return d; })
            .on("click", function(d) {
                console.log(d);
                // alert(d.srcElement.__data__);

                render_chart(data, d.srcElement.__data__);
            });
    }

    function render_chart(data, job_selected) {

        // filtered_data = new Map();
        //
        // for (let index = 0; index < data.length; ++index) {
        //     // if(data[index].job_title.toLowerCase())
        //     if(data[index].job_title == job_selected) {
        //         sal = filtered_data.get(data[index].work_year);
        //
        //         // console.log(data[index].work_year + "   " + sal);
        //         // console.log("11   "+ sal)
        //         if(sal == null || sal == undefined || sal == 'undefined')
        //             sal = data[index].salary;
        //         else
        //             sal = Math.max(sal, data[index].salary)
        //
        //         // console.log(data[index].work_year + "   " + sal);
        //         filtered_data.set(data[index].work_year, sal);
        //     }
        // }

        filtered_data = [];

        for (let index = 0; index < data.length; ++index) {
            // if(data[index].job_title.toLowerCase())
            if(data[index].job_title == job_selected) {
                filtered_data.push(data[index]);
            }
        }

        var mrg = {t: 10, r: 30, b: 30, l: 60};

        var plot_width = 600 - mrg.l - mrg.r;
        var plot_height = 500 - mrg.t - mrg.b;

        // Clear previous charts
        document.getElementById("data_plot").innerHTML = "";


        var svg = d3.select('#data_plot')
            .append("svg")
            .attr("width", plot_width + mrg.l  +  mrg.r)
            .attr("height", plot_height + mrg.t  + mrg.b)
            .append("g")
            .attr("transform",
                "translate("+  mrg.l + " , " + mrg.t  + " )  ");

        var x = d3.scaleBand()
            .domain([2020, 2021, 2022])
            .range([0, 500]);

        svg.append("g")
            .attr("transform", "translate( 0, " + plot_height + ")")
            .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3.scaleLinear()
            .domain([78000, 412000])
            .range([ plot_height, 0]);
        svg.append("g")
            .call(d3.axisLeft(y));
        // console.log(filtered_data);


        //sort data
        filtered_data.sort(function(x, y){
            return d3.ascending(x.work_year, y.work_year);
        })

        filtered_data.sort(function(x, y){
            return d3.ascending(x.salary, y.salary);
        })

        //.work_year, data[index].salary]
        // scatter
        svg.append('g')
            .selectAll("dot")
            .data(filtered_data)
            .enter()
            .append("circle")
            .attr("cx", function (d) { return x(parseInt(d.work_year)) + 83 ; } )
            .attr("cy", 0)
            .attr("r", 5)
            .style("fill", "#69b3a2");


        svg.selectAll("circle")
            .data(filtered_data)
            .transition()
            .duration(2000)
            .attr("cy", function (d) { console.log(d.salary);return y(parseInt(d.salary)); } )
            .delay(function(d, i){console.log(i);return(i*10)});

    }



</script>
</body>
